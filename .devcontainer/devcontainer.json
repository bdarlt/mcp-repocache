// .devcontainer/devcontainer.json
{
"build": {
  "dockerfile": "Dockerfile",
  "args": {
    "_DEV_CONTAINERS_BUILD_TMPFS_SIZE": "256m",
    "_CONTAINER_BUILD_TMPFS_SIZE": "512m"
  }
},
  "overrideFeatureInstallOrder": [
    "ghcr.io/devcontainers/features/common-utils",
    "ghcr.io/devcontainers-contrib/features/zsh-plugins"
  ],
  "features": {
    // Python 3.11 + pip + venv
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11"
    },
    // Let the official common-utils feature install zsh + oh-my-zsh
    //    for the remoteUser (node in your case).
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "installOhMyZsh": true,
      "upgradePackages": true,
      "username": "node" // same as remoteUser below
    },
    /* 2.  (Optional) add syntax-highlighting, auto-suggestions, etc. */
    "ghcr.io/devcontainers-extra/features/zsh-plugins": {
      "plugins": "git zsh-autosuggestions zsh-syntax-highlighting",
      "omzTemplates": "true"
    }
  },

  "runArgs": ["--cap-add=NET_ADMIN", "--cap-add=NET_RAW"],

  "customizations": {
    "vscode": {
      "extensions": [
        "anthropic.claude-code",
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "ms-python.black-formatter",
        "eamodio.gitlens"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "[javascript]": { "editor.defaultFormatter": "esbenp.prettier-vscode" },
        "[typescript]": { "editor.defaultFormatter": "esbenp.prettier-vscode" },
        "[javascriptreact]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[typescriptreact]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[python]": {
          "editor.defaultFormatter": "ms-python.black-formatter"
        },
        "editor.codeActionsOnSave": {
          "source.fixAll.eslint": "explicit"
        },
        "terminal.integrated.defaultProfile.linux": "zsh"
      }
    }
  },

  "remoteUser": "node",
  "containerEnv": {
    "NODE_OPTIONS": "--max-old-space-size=4096",
    "CLAUDE_CONFIG_DIR": "/home/node/.claude"
  },
  /* create the Claude directory so the extension never complains */
  "postCreateCommand": "python -m pip install --upgrade pip 'black>=24.0' && mkdir -p ${HOME}/.claude"
}
